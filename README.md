# <img src="https://user-images.githubusercontent.com/97428216/160321165-bd337416-a703-4f53-a1f7-5d8844ab66a2.png" align=left width=150> 꿈깨
> 온라인 3D 방탈출 게임 서비스 😴

<br />

## 💭 About

> ‘zzz’ 는 꿈을 꾸는 상태를 표현한 단어이자, 게임 프로젝트의 이름입니다
>
> ‘꿈’ 이라는 매체를 이용하여 상상하고 문제를 풀면서 해결하여
> 방탈출을 하는 것이 본 게임을 이어나갈 수 있는 방법입니다
>
> 당신은 꿈 속에서 얼마만큼의 역량을 발휘할 수 있는지 궁금하지 않으신가요?

<br />

## 📅 프로젝트 기간

- 2022.2.25 ~ 2022.4.9
- 1차 배포 : 2022.3.30

<br />

## 📌 바로가기
- Project : https://zzz-escape.netlify.app
- GitHub 메인페이지 : https://github.com/HangHae99Zzz
- 프론트엔드 GitHub Repository : https://github.com/HangHae99Zzz/dream_escape-fe
- 백엔드 GitHub Respository(NodeJS) : https://github.com/HangHae99Zzz/RoomEscape_BE-nodeJS

<br />

## ✨ 주요 기능

- **`홈`**
  방탈출 게임을 위한 방을 만들고, 랭킹조회 및 게임 설명을 확인할 수 있습니다.
- **`대기`**
  현재 대기중인 인원을 체크하고 게임을 시작할 수 있습니다. 링크로 친구를 초대하고, 보이스 채팅도 가능해요!
- **`게임`**
  팀원들과 보이스채팅을 나누며 방에 배치된 3D 물체를 클릭해 주어진 문제를 풀고 탈출할 수 있습니다. 제한시간 안에 방을 탈출해보세요.

<br />

## 🍎 Team Member - `BackEnd`

<!-- | <img src="" width=200>    | <img src="" width=200> | <img src="" width=200> | -->

|                 **김가은**                 |                  **최규원**                   |                  **반원재**                   |
| :----------------------------------------: | :-------------------------------------------: | :-------------------------------------------: |
| [@Kim gaeun](https://github.com/paran22) | [@Choi kyuwon](https://github.com/cooked-developer)  |[@Ban wonjae](https://github.com/wonjaeban)  |

<br />

## 📚 기술스택

<div align=center> 
  <img src="https://img.shields.io/badge/java-007396?style=for-the-badge&logo=java&logoColor=white">
  <img src="https://img.shields.io/badge/springboot-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
  <img src="https://img.shields.io/badge/gradle-02303A?style=for-the-badge&logo=gradle&logoColor=white">
  <img src="https://img.shields.io/badge/mockito-CB3837?style=for-the-badge&logo=mockito&logoColor=white">
  <img src="https://img.shields.io/badge/junit5-25A162?style=for-the-badge&logo=junit5&logoColor=white">
  <br>
  <img src="https://img.shields.io/badge/webrtc-333333?style=for-the-badge&logo=webrtc&logoColor=white">
  <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black"> 
  <img src="https://img.shields.io/badge/node.js-339933?style=for-the-badge&logo=Node.js&logoColor=white">
  <img src="https://img.shields.io/badge/express-000000?style=for-the-badge&logo=express&logoColor=white">
  <img src="https://img.shields.io/badge/pm2-2B037A?style=for-the-badge&logo=pm2&logoColor=white">
  <img src="https://img.shields.io/badge/socket.io-010101?style=for-the-badge&logo=socket.io&logoColor=white">
  <br>
  <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white">
  <img src="https://img.shields.io/badge/spring data jpa-F28D1A?style=for-the-badge&logo=springdatajpa&logoColor=white">
  <img src="https://img.shields.io/badge/aws ec2-07C160?style=for-the-badge&logo=amazonaws&logoColor=white">
  <img src="https://img.shields.io/badge/amazon s3-569A31?style=for-the-badge&logo=amazons3&logoColor=white">
  <br>
  <img src="https://img.shields.io/badge/aws codedeploy-9D1620?style=for-the-badge&logo=amazonaws&logoColor=white">
  <img src="https://img.shields.io/badge/aws codepipeline-072240?style=for-the-badge&logo=amazonaws&logoColor=white">
  <img src="https://img.shields.io/badge/nginx-009639?style=for-the-badge&logo=nginx&logoColor=white">
  <img src="https://img.shields.io/badge/github actions-2088FF?style=for-the-badge&logo=github actions&logoColor=white">
</div>

<div align=center><h3>Tools</h1></div>
<div align=center> 
  <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
  <img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
  <img src="https://img.shields.io/badge/swagger-85EA2D?style=for-the-badge&logo=swagger&logoColor=white">
</div>

<br />


## 🕹 Convention

`Coding Convention` · `Commit Convention`

<details markdown="1">
<summary>Coding Convention</summary>

### 📍 네이밍 Convention

  ✅ 폴더명은 소문자, Class명은 첫 글자 대문자
  <br>
  ✅ Method는 lowerCamelCase을 사용하고, 동사나 전치사로 시작한다. ex) get/set, init, is/has/can, create, find, to, A-By-B …
  <br>
  ✅ JUnit Test Method : Method명_테스트상태_기대행위  ex) isAdult_AgeLessThan18_False
</details>

<details markdown="2">
<summary>Commit Convention</summary>
  
### 📍 Commit Convention
  
  ✅ 유다시티 커밋 메시지 스타일 가이드 : [참고](https://udacity.github.io/git-styleguide/)
  <br>
  ✅ 본문에는 변경한 class 이름과 어떻게, 무엇을, 왜 변경했는지 자세히 적기
  ```
  커밋 타입: 제목
    //띄어쓰기
   본문
    //띄어쓰기
  (꼬리말 타입: #이슈 번호)
  ```
  
  <br />

> 🚨 커밋 타입

```
Docs: 문서 작업
Feat: 새로운 기능 추가
Fix: 버그를 고친 경우
Refactor: 리팩토링
Comment: 주석 추가 및 변경
Rename: 파일 혹은 폴더명 수정, 경로 변경
Remove: 파일 혹은 기능 삭제
Test: 테스트 관련 작업
Resolve conflicts: 충돌 발생 commit에서 사용(본문, 꼬리말 생략)
```
> 🚨 꼬리말 타입

```
Fixes: 이슈 수정중(아직 해결되지 않은 경우)
Resolves: 이슈 해결했을 때
Ref: 참고할 이슈가 있을 때
```
</details>

<br />

## ⚠️ Error

<details markdown="1">
<summary>Error 관리</summary>
<br>
✅ 모든 에러는 Error Code로 관리
<br>
✅ Error Code마다 httpStatus / errorCode / errorMessage 작성
<br>
✅ errorCode는 httpStatus마다 일련번호를 붙인다("httpStatus_number")  ex) "400_3", "404_4"

</details>

<br />

## 🐾 Branch Strategy

<details markdown="1">
<summary>브렌치 관리</summary>
<br>
✅ 개인별 브렌치(gaeun, kyuwon, wonjae)에서 작업 후 테스트 통과 확인한 후에 push → main으로 PR
<br>
✅ 기능 개발을 위해 별도로 테스트하는 경우에도 새로운 브렌치에서 작업 : 이후 반영 시 main으로 PR 후 Close
<br>
✅ nodeJS는 별도의 Repository에서 관리하며, main에서 작업 진행
<br />
</details>


<details markdown="1">
<summary>이슈 관리</summary>
<br>
✅ issue template 사용 : bug, feature
<br>
✅ issue 작성 내용 중 변경사항이 있는 경우에는 해당 글에 comment나 별도 이슈 생성
<br>
✅ 완료된 이슈는 commit Resolves 사용해서 Close
<br>
✅ 관련된 이슈가 많을 경우에는 Milestones를 사용해서 관리

</details>

<br />

## 📺 Detail

<details markdown="1">
<summary>아키텍처</summary>
  <img src="https://user-images.githubusercontent.com/97428216/160459796-c7f708e3-712a-4f33-9578-5c0f46db0acb.png">
</details>

<details markdown="2">
<summary>ERD</summary>
  <img src="https://user-images.githubusercontent.com/97428216/160526555-121176c2-32a6-4968-868c-669ae7234f14.png">

</details>

<details markdown="3">
<summary>API 명세서</summary>
  
> 🚨 API 설계규칙

```
Rest API URI 설계규칙을 따른다.
  1. 후행 /는 URI에 포함하지 않는다.
  2. 계층관계를 나타낼 때 슬래시 구분자를 사용한다. ex) /rooms/{roomId}/quizzes/{quizType}
  3. 긴 path를 표현하는 경우에는 가독성을 높이기 위해 하이픈(-)을 사용한다.
  4. 언더바(_)는 URI에 사용하지 않는다.
  5. URI는 모두 소문자로 작성한다.
  6. 파일확장자는 URI에 포함하지 않는다.
  7. 모든 resource는 복수형을 사용한다.
```
  <img src="https://user-images.githubusercontent.com/97428216/160456913-5247d722-6812-4400-93bf-0e3e0b540764.png">
  <img src="https://user-images.githubusercontent.com/97428216/160457294-af27cb69-7bd4-48d2-ba81-7c119516b9ea.png">
  <img src="https://user-images.githubusercontent.com/97428216/160457359-8365661e-f2a7-47be-a796-60f8af88071d.png">
  <img src="https://user-images.githubusercontent.com/97428216/160457415-5c72324d-3cb8-4ace-b715-b61f4c3f764c.png">
  <img src="https://user-images.githubusercontent.com/97428216/160457473-2c782847-91f2-4ef7-a9ef-584fa7d53c0c.png">
  <img src="https://user-images.githubusercontent.com/97428216/160457548-d2061496-984c-4ef3-bef4-ab313b324951.png">
</details>

<br />

## 🔨 Trouble Shooting

<details markdown="1">
<summary>WebRTC 서버 구축 문제</summary>

### ✅ P2P(signalling server) vs MCU/SFU → 📍 signalling server를 구축하자!
4명까지 보이스 채팅이 가능한 환경을 만들기 위해 어떤 서버를 사용해야 하는가?
<br>

```
📑 오디오만 사용하고, 4명까지만 연결하기 때문에 signalling server로도 client 부담이 크지 않을 거라고 생각했고,
MCU, SFU는 프로젝트 기한 내에 구현하기 어려울 것으로 판단했다.
```
<br>

### ✅ Springboot vs NodeJS → 📍 NodeJS의 Socket.io를 사용하여 signalling server를 구현하자!
다대다 WebRTC를 위한 signalling server를 어떻게 구현할 것인가?
<br>

```
📑 Springboot를 사용하면 하나의 서버만 관리하면 되고, 팀원들 모두가 익숙한 프레임워크를 사용할 수 있다.
그러나 참고자료가 많지 않다.
📑 NodeJS를 사용하면 Socket.io 라이브러리를 사용해서 비교적 쉽게 구현이 가능하나,
서버를 2개 관리해야 되기 때문에 유지관리에 비용이 더 소모되고, 익숙하지 않은 언어와 프레임워크를 사용해야 한다.
📑 그럼에도 NodeJS의 Socket.io를 사용하는 것이 프로젝트의 목표를 달성하기에 더 적합하다고 판단했다.
```
</details>

<details markdown="2">
<summary>유저 disconnect 처리 문제</summary>
  
### ✅ 문제상황

```
📑 유저가 브라우저를 종료하면 socket.io의 disconnect 이벤트가 발생
📑 Client는 방장이 나가면 새로운 방장을 알아야한다(방장만 게임 시작 가능!)
📑 DB에서는 disconnect된 유저 정보를 삭제하고, 방장이 변경된 경우 업데이트 필요
```
  
### 해결방안 1️⃣ nodeJS → Client →← Spring → ⚠️ 에러 발생
  
```
📑 nodeJS에서 disconnect시 event를 통해 disconnect된 유저의 socket.id를 Client로 보냄
📑 Client는 Spring으로 HTTP 통신을 통해 socket.id를 넘겨주고, 방장이 바뀐 경우 return 값을 받음
📑 유저가 1명 남았는데 disconnect가 되면 Client가 없으므로 nodeJS에서 DB로 쿼리를 보냄
  
  
⚠️ Client에서 동시에 여러 번 업데이트/삭제 요청이 발생하여 에러 발생!! → 📍 DB에 한 번만 요청하자!

```

### 해결방안 2️⃣ disconnect와 관련된 모든 DB처리는 nodeJS에서 처리
  
```
📑 disconnect시 DB에 필요한 업데이트/삭제 쿼리를 보내고, 방장이 변경되면 event로 해당 방 Client에게 알려줌
```
</details>

<details markdown="3">
<summary>게임 플레이 중 동시성 제어 문제</summary>
  
### ✅ 문제상황 → 📍 Socket.io의 이벤트를 활용해서 스코어나 찬스 변경 이벤트 발생 시 해당 방에 데이터 변경 사실 알려줌!

```
📑 게임 중 맞춘 문제 수(스코어), 찬스가 변경될 경우 해당 방 Client 모두에게 해당 정보를 업데이트해주어야 함
📑 HTTP 통신에서는 Client 요청 없이 Server가 Response 할 수 없으므로 socket 통신을 이용하면 해결할 수 있음!
```
  
</details>

<br />

## 🔧 Fight
